<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>RabbitMQ RPC and Micronaut</title>
    <link rel="canonical" href="@canonical@"/>

    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut Framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="https://micronaut.io/guides/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="https://micronaut.io/guides/">Guides</a> » <a href="micronaut-rabbitmq-rpc.html">RabbitMQ RPC and Micronaut</a> » <span class="breadcrumb_last" aria-current="page">maven | java</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        <ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-app">4. Writing the app</a>
<ul class="sectlevel2">
<li><a href="#catalogue-microservice">4.1. Catalogue microservice</a></li>
<li><a href="#inventory-microservice">4.2. Inventory microservice</a></li>
<li><a href="#recommendation-microservice">4.3. Recommendation microservice</a></li>
</ul>
</li>
<li><a href="#rabbitmq-and-micronaut">5. RabbitMQ and Micronaut</a>
<ul class="sectlevel2">
<li><a href="#install-rabbitmq-via-docker">5.1. Install RabbitMQ via Docker</a></li>
</ul>
</li>
<li><a href="#running-the-app">6. Running the app</a></li>
<li><a href="#generate-a-micronaut-apps-native-image-with-graalvm">7. Generate a Micronaut app&#8217;s Native Image with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#native-image-generation">7.1. Native Image generation</a></li>
</ul>
</li>
<li><a href="#next-steps">8. Next steps</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>RabbitMQ RPC and Micronaut</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Use RabbitMQ RPC to use request-reply pattern in your Micronaut applications.</p>
</div>
<div class="paragraph">
<p>Authors: Iván López</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 2.5.0</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide we are going to create a Micronaut app written in Java.</p>
</div>
<div class="paragraph">
<p>In this guide, we are going to create three microservices and communicate each other with <a href="https://www.rabbitmq.com/">RabbitMQ</a>
using the request-response pattern with <a href="https://micronaut-projects.github.io/micronaut-rabbitmq/latest/guide/#rpc">RPC</a>
<em>(Remote Procedure Call)</em>.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>RabbitMQ is an open-source message-broker software that originally implemented the Advanced Message Queuing Protocol (AMQP)
and has since been extended with a plug-in architecture to support Streaming Text Oriented Messaging Protocol (STOMP),
Message Queuing Telemetry Transport (MQTT), and other protocols.</p>
</div>
</blockquote>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the app step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-rabbitmq-rpc-maven-java.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-app">4. Writing the app</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s describe the microservices you are going to build through the tutorial.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>bookcatalogue</code> - It returns a list of books. It uses a domain consisting of a book name and isbn.</p>
</li>
<li>
<p><code>bookinventory</code> - It exposes an endpoint to check whether a book has sufficient stock to fulfill an order. It uses a domain consisting of a stock level and isbn.</p>
</li>
<li>
<p><code>bookrecommendation</code> - It consumes previous services and exposes an endpoint which recommends book names which are in stock.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you are using Java or Kotlin and IntelliJ IDEA, make sure you have enabled annotation processing.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/annotationprocessorsintellij.png" alt="annotationprocessorsintellij">
</div>
</div>
<div class="sect2">
<h3 id="catalogue-microservice">4.1. Catalogue microservice</h3>
<div class="paragraph">
<p>Create the <code>bookcatalogue</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookcatalogue</code></p>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookcatalogue, and a Micronaut app inside it with default package:
`example.micronaut</code>.</p>
</div>
<div class="paragraph">
<p>Add <code>rabbitmq</code> dependency. As we only want to use RabbitMQ to receive requests we can remove Micronaut HTTP client and Server.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.rabbitmq<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-rabbitmq<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>By default Micronaut will connect to a RabbitMQ instance running on <code>localhost</code> so it is not necessary to add anything
to <code>application.yml</code>. In case you want to change the configuration, add the following:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">rabbitmq</span>:
  <span class="key">uri</span>: <span class="string"><span class="content">amqp://localhost:5672</span></span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-exchange-queue-and-binding">4.1.1. Create RabbitMQ exchange, queue and binding</h4>
<div class="paragraph">
<p>Before being able to send and receive messages using RabbitMQ it is necessary to define the exchange, queue and binding.
One option is create them directly in the RabbitMQ Admin UI available on <code><a href="http://localhost:15672" class="bare">http://localhost:15672</a></code>. Use <code>guest</code> for both
username and password.</p>
</div>
<div class="paragraph">
<p>Another option is create them programmatically with Micronaut. Create the class <code>ChannelPoolListener.java</code>:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/java/example/micronaut/ChannelPoolListener.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">com.rabbitmq.client.BuiltinExchangeType</span>;
<span class="keyword">import</span> <span class="include">com.rabbitmq.client.Channel</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.connect.ChannelInitializer</span>;

<span class="keyword">import</span> <span class="include">javax.inject.Singleton</span>;
<span class="keyword">import</span> <span class="include">java.io.IOException</span>;

<span class="annotation">@Singleton</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">ChannelPoolListener</span> <span class="directive">extends</span> ChannelInitializer {

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">void</span> initialize(<span class="predefined-type">Channel</span> channel) <span class="directive">throws</span> <span class="exception">IOException</span> {
        channel.exchangeDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, BuiltinExchangeType.DIRECT, <span class="predefined-constant">true</span>); <i class="conum" data-value="1"></i><b>(1)</b>

        channel.queueDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">inventory</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>); <i class="conum" data-value="2"></i><b>(2)</b>
        channel.queueBind(<span class="string"><span class="delimiter">&quot;</span><span class="content">inventory</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">books.inventory</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>

        channel.queueDeclare(<span class="string"><span class="delimiter">&quot;</span><span class="content">catalogue</span><span class="delimiter">&quot;</span></span>, <span class="predefined-constant">true</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">false</span>, <span class="predefined-constant">null</span>); <i class="conum" data-value="4"></i><b>(4)</b>
        channel.queueBind(<span class="string"><span class="delimiter">&quot;</span><span class="content">catalogue</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">books.catalogue</span><span class="delimiter">&quot;</span></span>); <i class="conum" data-value="5"></i><b>(5)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Define an exchange named <code>micronaut</code>. From the producer point of view everything is sent to the exchange with the
appropriate routing key.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define a queue named <code>inventory</code>. The consumer will listen for messages in that queue.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Define a binding between the exchange and the queue using the routing key <code>books.inventory</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define a queue named <code>catalogue</code>. The consumer will listen for messages in that queue.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Define a binding between the exchange and the queue using the routing key <code>books.catalogue</code>.</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
In this Catalogue Microservice the only necessary element is the <code>catalogue</code> queue, but it is a good practice to define
all the elements in the same file and share the file between all the projects.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-consumer">4.1.2. Create consumer</h4>
<div class="paragraph">
<p>Create a <code>BookCatalogueService</code> class to handle incoming RPC requests into the <code>bookcatalogue</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/java/example/micronaut/BookCatalogueService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Queue</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitListener</span>;

<span class="keyword">import</span> <span class="include">java.util.Arrays</span>;
<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@RabbitListener</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookCatalogueService</span> {

    <span class="annotation">@Queue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">catalogue</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt; listBooks() {
        <span class="predefined-type">Book</span> buildingMicroservices = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Building Microservices</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Book</span> releaseIt = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">1680502395</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Release It!</span><span class="delimiter">&quot;</span></span>);
        <span class="predefined-type">Book</span> cidelivery = <span class="keyword">new</span> <span class="predefined-type">Book</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">0321601912</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Continuous Delivery:</span><span class="delimiter">&quot;</span></span>);

        <span class="keyword">return</span> <span class="predefined-type">Arrays</span>.asList(buildingMicroservices, releaseIt, cidelivery);
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@RabbitListener</code> to indicate that this bean will consume messages from RabbitMQ.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the method with <code>@Queue</code>. This listener will listen to messages in <code>catalogue</code> queue.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous service responds a <code>List&lt;Book&gt;</code>. Create the <code>Book</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/java/example/micronaut/Book.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">Book</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> isbn;
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> <span class="predefined-type">Book</span>() {
    }

    <span class="directive">public</span> <span class="predefined-type">Book</span>(<span class="predefined-type">String</span> isbn, <span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.isbn = isbn;
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getIsbn() {
        <span class="keyword">return</span> isbn;
    }

    <span class="directive">public</span> <span class="type">void</span> setIsbn(<span class="predefined-type">String</span> isbn) {
        <span class="local-variable">this</span>.isbn = isbn;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="predefined-type">String</span> toString() {
        <span class="keyword">return</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">Book{</span><span class="delimiter">&quot;</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">isbn='</span><span class="delimiter">&quot;</span></span> + isbn + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">&quot;</span><span class="content">, name='</span><span class="delimiter">&quot;</span></span> + name + <span class="string"><span class="delimiter">'</span><span class="char">\'</span><span class="delimiter">'</span></span> +
                <span class="string"><span class="delimiter">'</span><span class="content">}</span><span class="delimiter">'</span></span>;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        <span class="predefined-type">Book</span> book = (<span class="predefined-type">Book</span>) o;
        <span class="keyword">return</span> Objects.equals(isbn, book.isbn) &amp;&amp;
                Objects.equals(name, book.name);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(isbn, name);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="inventory-microservice">4.2. Inventory microservice</h3>
<div class="paragraph">
<p>Create the <code>bookinventory</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookinventory</code></p>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookinventory</code>, and a Micronaut app inside it with default package :
<code>example.micronaut</code>.</p>
</div>
<div class="paragraph">
<p>Add <code>rabbitmq</code> dependency. As we only want to use RabbitMQ to receive requests we can remove Micronaut HTTP client and Server.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.rabbitmq<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-rabbitmq<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-exchange-queue-and-binding-2">4.2.1. Create RabbitMQ exchange, queue and binding</h4>
<div class="paragraph">
<p>As we did in <code>Catalogue</code> Microservice, create the class <code>ChannelPoolListener.java</code> in <code>bookinventory/src/main/java/example/micronaut/bookcatalogue/ChannelPoolListener.java</code>
with the same content as before.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-consumer-2">4.2.2. Create consumer</h4>
<div class="paragraph">
<p>Create a <code>BookInventoryService</code> class to handle incoming RPC requests into the <code>bookinventory</code> microservice:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/java/example/micronaut/BookInventoryService.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Queue</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitListener</span>;

<span class="keyword">import</span> <span class="include">javax.validation.constraints.NotBlank</span>;
<span class="keyword">import</span> <span class="include">java.util.Optional</span>;

<span class="annotation">@RabbitListener</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookInventoryService</span> {

    <span class="annotation">@Queue</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">inventory</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">public</span> <span class="predefined-type">Boolean</span> stock(<span class="annotation">@NotBlank</span> <span class="predefined-type">String</span> isbn) {
        <span class="keyword">return</span> bookInventoryByIsbn(isbn).map(bi -&gt; bi.getStock() &gt; <span class="integer">0</span>).orElse(<span class="predefined-constant">null</span>);
    }

    <span class="directive">private</span> Optional&lt;BookInventory&gt; bookInventoryByIsbn(<span class="predefined-type">String</span> isbn) {
        <span class="keyword">if</span> (isbn.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">1491950358</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">return</span> Optional.of(<span class="keyword">new</span> BookInventory(isbn, <span class="integer">4</span>));
        } <span class="keyword">else</span> <span class="keyword">if</span> (isbn.equals(<span class="string"><span class="delimiter">&quot;</span><span class="content">1680502395</span><span class="delimiter">&quot;</span></span>)) {
            <span class="keyword">return</span> Optional.of(<span class="keyword">new</span> BookInventory(isbn, <span class="integer">0</span>));
        }
        <span class="keyword">return</span> Optional.empty();
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@RabbitListener</code> to indicate that this bean will consume messages from RabbitMQ.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Annotate the method with <code>@Queue</code>. This listener will listen to messages in <code>inventory</code> queue.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous service uses <code>BookInventory</code> POJO. Create it:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/java/example/micronaut/BookInventory.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookInventory</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> isbn;
    <span class="directive">private</span> <span class="predefined-type">Integer</span> stock;

    <span class="directive">public</span> BookInventory() {
    }

    <span class="directive">public</span> BookInventory(<span class="predefined-type">String</span> isbn, <span class="predefined-type">Integer</span> stock) {
        <span class="local-variable">this</span>.isbn = isbn;
        <span class="local-variable">this</span>.stock = stock;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getIsbn() {
        <span class="keyword">return</span> isbn;
    }

    <span class="directive">public</span> <span class="type">void</span> setIsbn(<span class="predefined-type">String</span> isbn) {
        <span class="local-variable">this</span>.isbn = isbn;
    }

    <span class="directive">public</span> <span class="predefined-type">Integer</span> getStock() {
        <span class="keyword">return</span> stock;
    }

    <span class="directive">public</span> <span class="type">void</span> setStock(<span class="predefined-type">Integer</span> stock) {
        <span class="local-variable">this</span>.stock = stock;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        BookInventory that = (BookInventory) o;
        <span class="keyword">return</span> Objects.equals(isbn, that.isbn) &amp;&amp;
                Objects.equals(stock, that.stock);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(isbn, stock);
    }
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="recommendation-microservice">4.3. Recommendation microservice</h3>
<div class="paragraph">
<p>Create the <code>bookrecommendation</code> microservice:</p>
</div>
<div class="paragraph">
<p><code>mn create-app example.micronaut.bookrecommendation</code></p>
</div>
<div class="paragraph">
<p>The previous command creates a folder named <code>bookrecommendation</code>, and a Micronaut app inside it with
default package: <code>example.micronaut</code>.</p>
</div>
<div class="paragraph">
<p>Add <code>rabbitmq</code> dependency. In this microservice we will use Micronaut HTTP Server to receive REST request, so it is
not necessary to remove any dependency.</p>
</div>
<div class="listingblock">
<div class="title">pom.xml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;dependency&gt;</span>
    <span class="tag">&lt;groupId&gt;</span>io.micronaut.rabbitmq<span class="tag">&lt;/groupId&gt;</span>
    <span class="tag">&lt;artifactId&gt;</span>micronaut-rabbitmq<span class="tag">&lt;/artifactId&gt;</span>
    <span class="tag">&lt;scope&gt;</span>compile<span class="tag">&lt;/scope&gt;</span>
<span class="tag">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect3">
<h4 id="create-rabbitmq-exchange-queue-and-binding-3">4.3.1. Create RabbitMQ exchange, queue and binding</h4>
<div class="paragraph">
<p>As we did in <code>Catalogue</code> Microservice, create the class <code>ChannelPoolListener.java</code> in <code>bookrecommendation/src/main/java/example/micronaut/bookcatalogue/ChannelPoolListener.java</code>
with the same content as before.</p>
</div>
</div>
<div class="sect3">
<h4 id="create-clients">4.3.2. Create clients</h4>
<div class="paragraph">
<p>Let&#8217;s create two interfaces to send messages to RabbitMQ. Micronaut will implement the interfaces at compilation time.
Create <code>CatalogueClient.java</code>:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/java/example/micronaut/CatalogueClient.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Binding</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitClient</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitProperty</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;

<span class="keyword">import</span> <span class="include">java.util.List</span>;

<span class="annotation">@RabbitClient</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@RabbitProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">replyTo</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">amq.rabbitmq.reply-to</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">CatalogueClient</span> {

    <span class="annotation">@Binding</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">books.catalogue</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    Flowable&lt;<span class="predefined-type">List</span>&lt;<span class="predefined-type">Book</span>&gt;&gt; findAll(<span class="type">byte</span><span class="type">[]</span> data); <i class="conum" data-value="4"></i><b>(4)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send the messages to exchange <code>micronaut</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the <code>replyTo</code> property to <code>amq.rabbitmq.reply-to</code>. This is a special queue that always exists and does not need
to be created. That it is why we did not create the queue in the <code>ChannelInitializer</code>. RabbitMQ uses that queue in a
special way and setting the value of the property <code>replyTo</code> to that queue will enable this call as a RPC one. RabbitMQ
will create a temporary queue for the callback.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the routing key.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the method that will "mirror" the one in the consumer. Keep in mind that in the consumer it is not possible to
return a reactive type, but on the client side it is. Also, it is necessary to send something, even if it&#8217;s not
used in the consumer.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Create <code>InventoryClient.java</code>:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/java/example/micronaut/InventoryClient.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.Binding</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitClient</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.rabbitmq.annotation.RabbitProperty</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Maybe</span>;

<span class="annotation">@RabbitClient</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">micronaut</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="annotation">@RabbitProperty</span>(name = <span class="string"><span class="delimiter">&quot;</span><span class="content">replyTo</span><span class="delimiter">&quot;</span></span>, value = <span class="string"><span class="delimiter">&quot;</span><span class="content">amq.rabbitmq.reply-to</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="directive">public</span> <span class="type">interface</span> <span class="class">InventoryClient</span> {

    <span class="annotation">@Binding</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">books.inventory</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    Maybe&lt;<span class="predefined-type">Boolean</span>&gt; stock(<span class="predefined-type">String</span> isbn); <i class="conum" data-value="4"></i><b>(4)</b>

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Send the messages to exchange <code>micronaut</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Set the <code>replyTo</code> property to <code>amq.rabbitmq.reply-to</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Set the routing key.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Define the method that will "mirror" the one in the consumer. As we did with <code>CatalogueClient</code> we use a reactive
type to wrap the result.</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="create-the-controller">4.3.3. Create the controller</h4>
<div class="paragraph">
<p>Create a Controller which injects both clients.</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/java/example/micronaut/BookController.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Controller</span>;
<span class="keyword">import</span> <span class="include">io.micronaut.http.annotation.Get</span>;
<span class="keyword">import</span> <span class="include">io.reactivex.Flowable</span>;

<span class="annotation">@Controller</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/books</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookController</span> {

    <span class="directive">private</span> <span class="directive">final</span> CatalogueClient catalogueClient; <i class="conum" data-value="2"></i><b>(2)</b>
    <span class="directive">private</span> <span class="directive">final</span> InventoryClient inventoryClient; <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="directive">public</span> BookController(CatalogueClient catalogueClient, InventoryClient inventoryClient) { <i class="conum" data-value="2"></i><b>(2)</b>
        <span class="local-variable">this</span>.catalogueClient = catalogueClient;
        <span class="local-variable">this</span>.inventoryClient = inventoryClient;
    }

    <span class="annotation">@Get</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="3"></i><b>(3)</b>
    <span class="directive">public</span> Flowable&lt;BookRecommendation&gt; index() {
        <span class="keyword">return</span> catalogueClient.findAll(<span class="predefined-constant">null</span>)
                .flatMap(Flowable::fromIterable)
                .flatMapMaybe(book -&gt; inventoryClient.stock(book.getIsbn())
                        .filter(<span class="predefined-type">Boolean</span>::booleanValue)
                        .map(response -&gt; book))
                .map(book -&gt; <span class="keyword">new</span> BookRecommendation(book.getName()));
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/books</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Clients are injected via constructor injection</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <code>@Get</code> annotation is used to map the index method to an HTTP GET request on <code>/books</code>.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous controller returns a <code>Flowable&lt;BookRecommendation&gt;</code>. Create the <code>BookRecommendation</code> POJO:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/java/example/micronaut/BookRecommendation.java</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="java"><span class="keyword">package</span> <span class="namespace">example.micronaut</span>;

<span class="keyword">import</span> <span class="include">io.micronaut.core.annotation.Introspected</span>;

<span class="keyword">import</span> <span class="include">java.util.Objects</span>;

<span class="annotation">@Introspected</span>
<span class="directive">public</span> <span class="type">class</span> <span class="class">BookRecommendation</span> {
    <span class="directive">private</span> <span class="predefined-type">String</span> name;

    <span class="directive">public</span> BookRecommendation() {
    }

    <span class="directive">public</span> BookRecommendation(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="directive">public</span> <span class="predefined-type">String</span> getName() {
        <span class="keyword">return</span> name;
    }

    <span class="directive">public</span> <span class="type">void</span> setName(<span class="predefined-type">String</span> name) {
        <span class="local-variable">this</span>.name = name;
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">boolean</span> equals(<span class="predefined-type">Object</span> o) {
        <span class="keyword">if</span> (<span class="local-variable">this</span> == o) <span class="keyword">return</span> <span class="predefined-constant">true</span>;
        <span class="keyword">if</span> (o == <span class="predefined-constant">null</span> || getClass() != o.getClass()) <span class="keyword">return</span> <span class="predefined-constant">false</span>;
        BookRecommendation that = (BookRecommendation) o;
        <span class="keyword">return</span> Objects.equals(name, that.name);
    }

    <span class="annotation">@Override</span>
    <span class="directive">public</span> <span class="type">int</span> hashCode() {
        <span class="keyword">return</span> Objects.hash(name);
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="rabbitmq-and-micronaut">5. RabbitMQ and Micronaut</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="install-rabbitmq-via-docker">5.1. Install RabbitMQ via Docker</h3>
<div class="paragraph">
<p>The fastest way to start using <a href="https://hub.docker.com/_/rabbitmq/">RabbitMQ is via Docker</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">docker run --rm -it \
        -p 5672:5672 \
        -p 15672:15672 \
        rabbitmq:3.8.12-management</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can <a href="https://www.rabbitmq.com/download.html">install and run a local RabbitMQ instance</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="running-the-app">6. Running the app</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Configure <code>bookinventory</code> to run on port 8082:</p>
</div>
<div class="listingblock">
<div class="title">bookinventory/src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">server</span>:
    <span class="key">port</span>: <span class="string"><span class="content">8082 </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookinventory</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">bookinventory $ ./mvnw mn:run

13:30:22.426 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 742ms. Server Running: 1 active message listeners.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure <code>bookcatalogue</code> to run on port 8081:</p>
</div>
<div class="listingblock">
<div class="title">bookcatalogue/src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">server</span>:
    <span class="key">port</span>: <span class="string"><span class="content">8081 </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>Run <code>bookcatalogue</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">bookcatalogue $ ./mvnw mn:run

13:31:19.887 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 949ms. Server Running: 1 active message listeners.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Configure <code>bookrecommendation</code> to run on port 8080:</p>
</div>
<div class="listingblock">
<div class="title">bookrecommendation/src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">micronaut</span>:
  <span class="key">server</span>:
    <span class="key">port</span>: <span class="string"><span class="content">8080 </span></span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
8080 is the default port if you don&#8217;t specify <code>micronaut.server.port</code> property
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Run <code>bookrecommendation</code> microservice:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">bookcatalogue $ ./mvnw mn:run

13:32:06.045 [main] INFO  io.micronaut.runtime.Micronaut - Startup completed in 959ms. Server Running: http://localhost:8080</code></pre>
</div>
</div>
<div class="paragraph">
<p>You can run a <code>curl</code> command to test the whole application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ curl http://localhost:8080/books
[{&quot;name&quot;:&quot;Building Microservices&quot;}]</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-apps-native-image-with-graalvm">7. Generate a Micronaut app&#8217;s Native Image with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to use <a href="https://www.graalvm.org/">GraalVM</a>, the polyglot embeddable virtual machine, to generate a Native image of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Native images compiled with GraalVM ahead-of-time improve the startup time and reduce the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of GraalVM&#8217;s <code>native-image</code> tool is only supported in Java or Kotlin projects. Groovy relies heavily on
reflection which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="native-image-generation">7.1. Native Image generation</h3>
<div class="paragraph">
<p>The easiest way to install GraalVM is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># For Java 8
$ sdk install java 21.1.0.r8-grl

# For Java 11
$ sdk install java 21.1.0.r11-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to install the <code>native-image</code> component which is not installed by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a native image using Maven run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw package -Dpackaging=native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native image will be created in <code>target/application</code> and can be run with <code>./target/application</code>.</p>
</div>
<div class="paragraph">
<p>Start the native images for the two microservices and run the same <code>curl</code> request as before to check that everything works with GraalVM.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">8. Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Read more about <a href="https://micronaut-projects.github.io/micronaut-rabbitmq/latest/guide/#rpc">RabbitMQ RPC support</a> inside Micronaut.</p>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="https://micronaut.io/wp-content/uploads/2021/03/Micronaut_byobjectcomputing_w.svg" alt=""/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li id="menu-item-2885" class="show-on-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-2885">
                                <a target="_blank" rel="noopener" href="https://micronaut.io/feed/rss/">
                                    <i class="fas fa-rss">
                                        <span class="sr-only">RSS</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2886" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2886">
                                <a target="_blank" rel="noopener" href="https://twitter.com/micronautfw">
                                    <i class="fab fa-twitter">
                                        <span class="sr-only">Twitter</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2887" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2887">
                                <a href="mailto:info@micronaut.io">
                                    <i class="fas fa-envelope">
                                        <span class="sr-only">Mail</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2888" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2888">
                                <a target="_blank" rel="noopener" href="https://gitter.im/micronautfw/">
                                    <i class="fab fa-gitter">
                                        <span class="sr-only">Gitter</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2889" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2889">
                                <a target="_blank" rel="noopener" href="https://github.com/micronaut-projects/">
                                    <i class="fab fa-github">
                                        <span class="sr-only">GitHub</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2890" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2890">
                                <a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLI74De5M9T72YshO4Sc90wtGr286nM8Yu">
                                    <i class="fab fa-youtube">
                                        <span class="sr-only">YouTube</span>
                                    </i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2021 Object Computing, Inc. All rights reserved</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>


<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1'/>
    <title>Micronaut HTTP Client</title>
    <link rel="canonical" href="@canonical@"/>

    <link rel='stylesheet' id='wp-block-library-css' href='https://micronaut.io/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all'/>
    <link rel='stylesheet' id='fonts-fira-sans-css' href='https://fonts.googleapis.com/css2?family=Fira+Sans%3Awght%40300%3B500&#038;display=swap&#038;ver=5.7' type='text/css' media='all'/>
    <link rel='stylesheet' id='micronaut-style-css' href='https://micronaut.io/wp-content/themes/micronaut/style.min.css' type='text/css' media='all'/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link rel="shortcut icon" href="https://micronaut.io/wp-content/uploads/2021/02/favicon.ico" type="image/png">
    <link href="coderay.css" rel="stylesheet" />
</head>
<body class="page-template page-template-page-sidebar page-template-page-sidebar-php page page-parent guide">

<header id="header">

    <div class="container">

        <nav class="navbar navbar-expand-lg navbar-dark">

            <button class="collapsed" type="button" data-toggle="collapse" data-target="#nav" aria-expanded="false">
                <span></span>
            </button>

            <a class="navbar-brand" href="https://micronaut.io">
                <img src="https://micronaut.io/wp-content/uploads/2020/11/MIcronautLogo_Horizontal.svg" alt="Micronaut Framework"/>
            </a>

            <div class="collapse navbar-collapse" id="nav">

                <ul class="navbar-nav ml-auto">

                    <li id="menu-item-2865" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2865 nav-item">
                        <a href="https://micronaut.io/download/" class="nav-link">Download</a>
                    </li>
                    <li id="menu-item-2868" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item current-menu-ancestor current-menu-parent current_page_parent current_page_ancestor menu-item-has-children menu-item-2872 active dropdown nav-item">
                        <a href="https://micronaut.io/guides/" class="nav-link dropdown-toggle" data-toggle="dropdown">Learn</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2869" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2869">
                                <a href="https://micronaut.io/docs/" class="dropdown-item">User Documentation</a>
                            </li>
                            <li id="menu-item-2870" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2870">
                                <a href="https://micronaut.io/guides/" class="dropdown-item">Guides</a>
                            </li>
                            <li id="menu-item-2896" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2896">
                                <a href="https://micronaut.io/category/microcast/" class="dropdown-item">Microcasts</a>
                            </li>
                            <li id="menu-item-2897" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-2897">
                                <a href="https://micronaut.io/category/webinar/" class="dropdown-item">Webinars</a>
                            </li>
                            <li id="menu-item-2871" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2871">
                                <a href="https://micronaut.io/professional-training/" class="dropdown-item">Professional Training</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2878" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/resources/" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2879" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2879">
                                <a href="https://micronaut.io/blog/" class="dropdown-item">Blog</a>
                            </li>
                            <li id="menu-item-2881" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2881">
                                <a href="https://micronaut.io/events/" class="dropdown-item">Upcoming Events</a>
                            </li>
                            <li id="menu-item-2880" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2880">
                                <a href="https://micronaut.io/commercial-support/" class="dropdown-item">Commercial Support</a>
                            </li>
                            <li id="menu-item-2882" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2882">
                                <a href="https://micronaut.io/faq/" class="dropdown-item">FAQ</a>
                            </li>
                            <li id="menu-item-2883" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2883">
                                <a href="https://micronaut.io/contact/" class="dropdown-item">Contact</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2872" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-2878 dropdown nav-item">
                        <a href="https://micronaut.io/foundation/" aria-current="page" class="nav-link dropdown-toggle" data-toggle="dropdown">Foundation</a>
                        <ul class="dropdown-menu">
                            <li id="menu-item-2877" class="menu-item menu-item-type-post_type menu-item-object-page current-menu-item page_item page-item-22 current_page_item menu-item-2877 active">
                                <a href="https://micronaut.io/foundation/" aria-current="page" class="dropdown-item">Overview</a>
                            </li>
                            <li id="menu-item-2874" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2874">
                                <a href="https://micronaut.io/foundation/corporate-sponsorship/" class="dropdown-item">Corporate Sponsorship</a>
                            </li>
                            <li id="menu-item-2873" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2873">
                                <a href="https://micronaut.io/foundation/community-sponsorship/" class="dropdown-item">Community Sponsorship</a>
                            </li>
                            <li id="menu-item-2876" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2876">
                                <a href="https://micronaut.io/foundation/sponsors/" class="dropdown-item">Sponsors</a>
                            </li>
                        </ul>
                    </li>
                    <li id="menu-item-2884" class="action menu-item menu-item-type-custom menu-item-object-custom menu-item-2884 nav-item">
                        <a target="_blank" rel="noopener" href="https://micronaut.io/launch/" class="nav-link">Launch</a>
                    </li>
                </ul>
            </div>

        </nav>

    </div>
</header>
<div id="breadcrumbs"><div class="container"><a href="https://micronaut.io/">Home</a> » <a href="https://micronaut.io/guides/">Guides</a> » <a href="micronaut-http-client.html">Micronaut HTTP Client</a> » <span class="breadcrumb_last" aria-current="page">maven | kotlin</span></div></div><!-- .breadcrumbs -->
<main id="main">
    <div class="container">
        <div class="row">
            <div class="col-md-4">

                <div class="toc">
                    <div class="inner">
                        <h1 class="title title_large first-word-bold first-word-break">Table of Contents</h1>
                        <div class="underline"></div>
                        <ul class="sectlevel1">
<li><a href="#getting-started">1. Getting Started</a></li>
<li><a href="#what-you-will-need">2. What you will need</a></li>
<li><a href="#solution">3. Solution</a></li>
<li><a href="#writing-the-app">4. Writing the App</a>
<ul class="sectlevel2">
<li><a href="#github-api">4.1. GitHub API</a></li>
<li><a href="#low-level-client">4.2. Low Level Client</a></li>
<li><a href="#declarative-client">4.3. Declarative Client</a></li>
<li><a href="#controller">4.4. Controller</a></li>
<li><a href="#tests">4.5. Tests</a></li>
</ul>
</li>
<li><a href="#testing-the-application">5. Testing the Application</a></li>
<li><a href="#http-client-filter">6. HTTP Client Filter</a>
<ul class="sectlevel2">
<li><a href="#configuration-parameters">6.1. Configuration Parameters</a></li>
</ul>
</li>
<li><a href="#generate-a-micronaut-apps-native-image-with-graalvm">7. Generate a Micronaut app&#8217;s Native Image with GraalVM</a>
<ul class="sectlevel2">
<li><a href="#native-image-generation">7.1. Native Image generation</a></li>
</ul>
</li>
<li><a href="#next-steps">8. Next steps</a></li>
<li><a href="#help-with-micronaut">9. Help with Micronaut</a></li>
</ul>

                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <h1>Micronaut HTTP Client</h1>
                <div class="underline"></div>
<div class="sect1">
<div class="sectionbody">

<div class="paragraph">
<p>Learn how to use Micronaut low-level HTTP Client. Simplify your code with the declarative HTTP client.</p>
</div>
<div class="paragraph">
<p>Authors: Sergio del Amo, Iván López</p>
</div>
<div class="paragraph">
<p>Micronaut Version: 2.5.0</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="getting-started">1. Getting Started</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In this guide we are going to create a Micronaut app written in Kotlin to consume the GitHub API with the Micronaut HTTP Client.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="what-you-will-need">2. What you will need</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.8 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="solution">3. Solution</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We recommend that you follow the instructions in the next sections and create the app step by step. However, you can go right to the <strong>completed example</strong>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="micronaut-http-client-maven-kotlin.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="writing-the-app">4. Writing the App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Create an app using the <a href="https://docs.micronaut.io/latest/guide/index.html#cli">Micronaut Command Line Interface</a> or with
<a href="https://launch.micronaut.io">Micronaut Launch</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">mn create-app example.micronaut.micronautguide --build=maven --lang=kotlin</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you don&#8217;t specify the <code>--build</code> argument, Gradle is used as a build tool. <br/> If you don&#8217;t specify the <code>--lang</code> argument, Java is used as a language.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous command creates a Micronaut app with the default package <code>example.micronaut</code> in a folder named <code>micronautguide</code>.</p>
</div>
<div class="paragraph">
<p>If you are using Java or Kotlin and IntelliJ IDEA, make sure you have enabled annotation processing.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/annotationprocessorsintellij.png" alt="annotationprocessorsintellij">
</div>
</div>
<div class="sect2">
<h3 id="github-api">4.1. GitHub API</h3>
<div class="paragraph">
<p>In this guide, you are going to consume the <a href="https://docs.github.com/en/rest">GitHub API</a> from a Micronaut application.</p>
</div>
<div class="paragraph">
<p>In particular, we consume the <a href="https://docs.github.com/en/rest/reference/repos#list-releases">List releases</a> endpoint.</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>This returns a list of releases, which does not include regular Git tags that have not been associated with a release.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>This API resource can be consumed by both authenticated and anonymous clients.</p>
</div>
<div class="paragraph">
<p>Initially, you will consume it anonymously, later we will discuss authentication.</p>
</div>
<div class="paragraph">
<p>Modify <code>src/main/resources/application.yml</code> to create some configuration parameters.</p>
</div>
<div class="listingblock">
<div class="title">src/main/resources/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">github</span>:
  <span class="key">organization</span>: <span class="string"><span class="content">micronaut-projects</span></span>
  <span class="key">repo</span>: <span class="string"><span class="content">micronaut-core</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>To encapsulate type-safe configuration retrieval, we use a <a href="https://docs.micronaut.io/latest/guide/index.html#configurationProperties"><code>@ConfigurationProperties</code></a> object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubConfiguration.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.annotation.ConfigurationProperties
import io.micronaut.context.annotation.Requires

@ConfigurationProperties(GithubConfiguration.PREFIX)
@Requires(property = GithubConfiguration.PREFIX)
class GithubConfiguration {
    var organization: String? = null
    var repo: String? = null
    var username: String? = null
    var token: String? = null

    companion object {
        const val PREFIX = &quot;github&quot;
        const val GITHUB_API_URL = &quot;https://api.github.com&quot;
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this guide, you are going to fetch <a href="https://github.com/micronaut-projects/micronaut-core/releases">Micronaut Core releases</a>.</p>
</div>
<div class="paragraph">
<p>To consume the GitHub API, you will use Micronaut HTTP Client.</p>
</div>
</div>
<div class="sect2">
<h3 id="low-level-client">4.2. Low Level Client</h3>
<div class="paragraph">
<p>Initially, you will create a Bean which uses the low-level Client API.</p>
</div>
<div class="paragraph">
<p>Create a POJO to parse the JSON response into an object:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubRelease.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.core.annotation.Introspected

@Introspected
data class GithubRelease(val name: String, val url: String)</code></pre>
</div>
</div>
<div class="paragraph">
<p>Create <code>GithubLowLevelClient</code>:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubLowLevelClient.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpHeaders.ACCEPT
import io.micronaut.http.HttpHeaders.USER_AGENT
import io.micronaut.http.HttpRequest
import io.micronaut.http.client.RxHttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.http.uri.UriBuilder
import io.reactivex.Maybe
import java.net.URI
import javax.inject.Singleton

@Singleton <i class="conum" data-value="1"></i><b>(1)</b>
class GithubLowLevelClient(@param:Client(GithubConfiguration.GITHUB_API_URL) private val httpClient: RxHttpClient,  <i class="conum" data-value="2"></i><b>(2)</b>
                           configuration: GithubConfiguration) {  <i class="conum" data-value="3"></i><b>(3)</b>
    private val uri: URI = UriBuilder.of(&quot;/repos&quot;)
        .path(configuration.organization)
        .path(configuration.repo)
        .path(&quot;releases&quot;)
        .build()

    fun fetchReleases(): Maybe&lt;List&lt;GithubRelease&gt;&gt; {
        val req: HttpRequest&lt;*&gt; = HttpRequest.GET&lt;Any&gt;(uri) <i class="conum" data-value="4"></i><b>(4)</b>
            .header(USER_AGENT, &quot;Micronaut HTTP Client&quot;) <i class="conum" data-value="5"></i><b>(5)</b>
            .header(ACCEPT, &quot;application/vnd.github.v3+json, application/json&quot;) <i class="conum" data-value="6"></i><b>(6)</b>
        val flowable = httpClient.retrieve(req, Argument.listOf(GithubRelease::class.java)) <i class="conum" data-value="7"></i><b>(7)</b>
        return flowable.firstElement() <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Use <code>javax.inject.Singleton</code> to designate a class as a singleton.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject <code>RxClient</code> via constructor injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Inject the previously defined configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Creating HTTP Requests is easy thanks to Micronaut&#8217;s fluid API.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use <code>retrieve</code> to perform an HTTP request for the given request object and convert the full HTTP response&#8217;s body into the specified type. e.g. <code>List&lt;GithubRelease&gt;</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The <code>retrieve</code> method returns a Flowable which has a firstElement method that returns the first emitted item or nothing</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Instead of <code>retrieve</code> we could have used <code>jsonStream</code>. You can use <code>jsonStream()</code> to stream arrays of type <code>application/json</code> or
JSON streams of type <code>application/x-json-stream</code>. If we use <code>retrieve</code>, such as in the previous code listing, the operation will not block.
However, it will not return until all the data has been received from the server. In the case of a JSON array that would be the whole array.
However, if you are interested in just the first element of the array, <code>jsonStream</code> provides a better alternative since it starts streaming data from the server without needing the whole response.
For example, <code>jsonStream().firstElement()</code> will only parse the first item in a JSON array. Hence it is more efficient.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="declarative-client">4.3. Declarative Client</h3>
<div class="paragraph">
<p>It is time to take a look at Micronaut&#8217;s support for declarative clients via the Client annotation.</p>
</div>
<div class="paragraph">
<p>Create <code>GithubApiClient</code> which clearly illustrates how a declarative Micronaut HTTP Client, which is generated at compile-time, simplifies our code.</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubApiClient.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.HttpHeaders.ACCEPT
import io.micronaut.http.HttpHeaders.USER_AGENT
import io.micronaut.http.annotation.Get
import io.micronaut.http.annotation.Header
import io.micronaut.http.annotation.Headers
import io.micronaut.http.client.annotation.Client
import io.reactivex.Flowable

@Client(GithubConfiguration.GITHUB_API_URL) <i class="conum" data-value="1"></i><b>(1)</b>
@Headers(
    Header(name = USER_AGENT, value = &quot;Micronaut HTTP Client&quot;), <i class="conum" data-value="2"></i><b>(2)</b>
    Header(name = ACCEPT, value = &quot;application/vnd.github.v3+json, application/json&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
)
interface GithubApiClient {

    @Get(&quot;/repos/\${github.organization}/\${github.repo}/releases&quot;) <i class="conum" data-value="4"></i><b>(4)</b>
    fun fetchReleases(): Flowable&lt;GithubRelease?&gt;? <i class="conum" data-value="5"></i><b>(5)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>URL of the remote service</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>GitHub API requires to set the <code>User-Agent</code> header.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>GitHub encourages to explicitly request the version 3 via the <code>Accept</code> header. With <code>@Header</code>, you add the <code>Accept: application/vnd.github.v3+json</code> HTTP header to every request.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>You can use configuration parameter interpolation when you define the path of the GET endpoint.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>You can return reactive types, such as an RxJava <code>Flowable</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="controller">4.4. Controller</h3>
<div class="paragraph">
<p>Create a Controller. It uses both (low-level and declarative clients). It showcases several Micronaut&#8217;s capabilities.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Micronaut supports any framework that implements Reactive Streams, including RxJava, and Reactor. Thus, you can easily and efficiently
compose multiple HTTP client calls without blocking (which will limit the throughput and scalability of your application).</p>
</li>
<li>
<p>Micronaut enables you to consume/produce <a href="https://docs.micronaut.io/latest/guide/index.html#clientStreaming">JSON Streams</a>.</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubController.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.http.MediaType
import io.micronaut.http.annotation.Controller
import io.micronaut.http.annotation.Get
import io.reactivex.Flowable
import io.reactivex.Maybe

@Controller(&quot;/github&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
class GithubController(private val githubLowLevelClient: GithubLowLevelClient, <i class="conum" data-value="2"></i><b>(2)</b>
                       private val githubApiClient: GithubApiClient) {

    @Get(&quot;/releases-lowlevel&quot;) <i class="conum" data-value="3"></i><b>(3)</b>
    fun releasesWithLowLevelClient(): Maybe&lt;List&lt;GithubRelease&gt;&gt; { <i class="conum" data-value="4"></i><b>(4)</b>
        return githubLowLevelClient.fetchReleases()
    }

    @Get(uri = &quot;/releases&quot;, produces = [MediaType.APPLICATION_JSON_STREAM]) <i class="conum" data-value="5"></i><b>(5)</b>
    fun fetchReleases(): Flowable&lt;GithubRelease?&gt;? { <i class="conum" data-value="6"></i><b>(6)</b>
        return githubApiClient.fetchReleases()
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The class is defined as a controller with the <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Controller.html">@Controller</a> annotation mapped to the path <code>/github</code>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject beans via constructor injection.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The <a href="https://docs.micronaut.io/latest/api/io/micronaut/http/annotation/Get.html">@Get</a> annotation is used to map the index method to all requests that use an HTTP GET</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The <code>releasesWithLowLevelClient</code> returns a Maybe which may or may not emit an item. If an item is not emitted a 404 is returned.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>In order to do JSON streaming you can declare a controller method that returns a <code>application/x-json-stream</code> of JSON objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>You can return reactive types, such as an RxJava <code>Flowable</code>.</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="tests">4.5. Tests</h3>
<div class="paragraph">
<p>Create a test which verifies both clients work as expected and the controller echoes the output of the GitHub API in a Reactive way.</p>
</div>
<div class="listingblock">
<div class="title">src/test/kotlin/example/micronaut/GithubControllerTest.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.core.type.Argument
import io.micronaut.http.HttpRequest
import io.micronaut.http.HttpStatus
import io.micronaut.http.client.RxStreamingHttpClient
import io.micronaut.http.client.annotation.Client
import io.micronaut.test.extensions.junit5.annotation.MicronautTest
import org.junit.jupiter.api.Assertions.assertEquals
import org.junit.jupiter.api.Assertions.assertNotNull
import org.junit.jupiter.api.Assertions.assertTrue
import org.junit.jupiter.api.Test
import java.util.stream.StreamSupport
import javax.inject.Inject

@MicronautTest <i class="conum" data-value="1"></i><b>(1)</b>
class GithubControllerTest {

    @Inject
    @field:Client(&quot;/&quot;)
    lateinit var client: RxStreamingHttpClient <i class="conum" data-value="2"></i><b>(2)</b>

    @Test
    fun verifyGithubReleasesCanBeFetchedWithLowLevelHttpClient() {
        //when:
        val request: HttpRequest&lt;Any&gt; = HttpRequest.GET(&quot;/github/releases-lowlevel&quot;)
        val rsp = client.toBlocking().exchange(request, <i class="conum" data-value="3"></i><b>(3)</b>
            Argument.listOf(GithubRelease::class.java)) <i class="conum" data-value="4"></i><b>(4)</b>

        //then: 'the endpoint can be accessed'
        assertEquals(HttpStatus.OK, rsp.status) <i class="conum" data-value="5"></i><b>(5)</b>
        assertNotNull(rsp.body()) <i class="conum" data-value="6"></i><b>(6)</b>

        //when:
        val releases = rsp.body()

        //then:
        for (name in expectedReleases) {
            assertTrue(releases.stream().map(GithubRelease::name).anyMatch { anObject: String? -&gt; name.equals(anObject) })
        }
    }

    @Test
    fun verifyGithubReleasesCanBeFetchedWithCompileTimeAutoGeneratedAtClient() {
        //when:
        val request: HttpRequest&lt;Any&gt; = HttpRequest.GET(&quot;/github/releases-lowlevel&quot;)
        val githubReleaseStream = client.jsonStream(request, GithubRelease::class.java) <i class="conum" data-value="7"></i><b>(7)</b>
        val githubReleases = githubReleaseStream.blockingIterable()

        //then:
        for (name in expectedReleases) {
            assertTrue(StreamSupport.stream(githubReleases.spliterator(), false)
                .map(GithubRelease::name)
                .anyMatch { anObject: String? -&gt; name.equals(anObject) })
        }
    }

    companion object {
        private val expectedReleases = listOf(&quot;Micronaut 2.5.0&quot;, &quot;Micronaut 2.4.4&quot;, &quot;Micronaut 2.4.3&quot;)
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Annotate the class with <code>@MicronautTest</code> to let Micronaut starts the embedded server and inject the beans. More info: <a href="https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html">https://micronaut-projects.github.io/micronaut-test/latest/guide/index.html</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Inject the <code>RxStreamingHttpClient</code> bean in the application context.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Sometimes, receiving just the object is not enough, and you need information about the response. In this case, instead of <code>retrieve</code> you should use the <code>exchange</code> method.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Micronaut makes it easy to parse JSON into Java objects.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Use <code>status</code> to check the HTTP status code.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Use <code>.body()</code> to retrieve the parsed payload.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Use the <code>jsonStream</code> method, which returns a <code>Flowable</code>, to consume the endpoint which generates a JSON Stream.</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="testing-the-application">5. Testing the Application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw test</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="http-client-filter">6. HTTP Client Filter</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Often, you need to include the same HTTP headers or URL parameters in a set of requests against a third-party API or when
calling another Microservice. To simplify this, Micronaut includes the ability to define <code>HttpClientFilter</code> classes that
are applied to all matching HTTP clients.</p>
</div>
<div class="paragraph">
<p>For a real world example, let us provide GitHub Authentication via an <code>HttpClientFilter</code>. Follow the steps in
<a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">to create you own Personal Token</a>.
Then you can use those credentials to access the GitHub API
<a href="https://docs.github.com/en/rest/overview/other-authentication-methods#via-oauth-and-personal-access-tokens">using Basic Auth</a>.</p>
</div>
<div class="paragraph">
<p>Create a Filter:</p>
</div>
<div class="listingblock">
<div class="title">src/main/kotlin/example/micronaut/GithubFilter.kt</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="kotlin">package example.micronaut

import io.micronaut.context.annotation.Requires
import io.micronaut.http.HttpResponse
import io.micronaut.http.MutableHttpRequest
import io.micronaut.http.annotation.Filter
import io.micronaut.http.filter.ClientFilterChain
import io.micronaut.http.filter.HttpClientFilter
import org.reactivestreams.Publisher

@Filter(&quot;/repos/**&quot;) <i class="conum" data-value="1"></i><b>(1)</b>
@Requires(condition = GithubFilterCondition::class) <i class="conum" data-value="2"></i><b>(2)</b>
class GithubFilter(val configuration: GithubConfiguration) : HttpClientFilter { <i class="conum" data-value="3"></i><b>(3)</b>

    override fun doFilter(request: MutableHttpRequest&lt;*&gt;, chain: ClientFilterChain): Publisher&lt;out HttpResponse&lt;*&gt;?&gt; {
        return chain.proceed(request.basicAuth(configuration.username, configuration.token)) <i class="conum" data-value="4"></i><b>(4)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Supply the pattern you want to match to the <code>@Filter</code> annotation.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Micronaut will not load the Bean unless configuration properties are set.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Constructor injection of the configuration parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Enhance every request sent to GitHub API providing Basic Authentication.</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="configuration-parameters">6.1. Configuration Parameters</h3>
<div class="paragraph">
<p>Add your GitHub <code>username</code> and <code>token</code> to <code>src/main/resource/application.yml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">github</span>:
  <span class="key">organization</span>: <span class="string"><span class="content">micronaut-projects</span></span>
  <span class="key">repo</span>: <span class="string"><span class="content">micronaut-core</span></span>
  <span class="key">username</span>: <span class="string"><span class="content">yourgithubusername</span></span>
  <span class="key">token</span>: <span class="string"><span class="content">xxxxxxxxxxxx</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add to <code>src/main/resources/logback.xml</code>, a logger to see Micronaut&#8217;s HTTP client output.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="xml"><span class="tag">&lt;logger</span> <span class="attribute-name">name</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut.http.client</span><span class="delimiter">&quot;</span></span> <span class="attribute-name">level</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">TRACE</span><span class="delimiter">&quot;</span></span><span class="tag">/&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you run again the tests, you will see the that the Filter is invoked and HTTP Basic Auth is used against GitHub API.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">13:09:56.662 [default-nioEventLoopGroup-1-4] DEBUG i.m.h.client.netty.DefaultHttpClient - Sending HTTP GET to https://api.github.com/repos/micronaut-projects/micronaut-core/releases
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - User-Agent: Micronaut HTTP Client
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Accept: application/json
13:09:56.663 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - Authorization: Basic xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
13:09:56.664 [default-nioEventLoopGroup-1-4] TRACE i.m.h.client.netty.DefaultHttpClient - host: api.github.com</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="generate-a-micronaut-apps-native-image-with-graalvm">7. Generate a Micronaut app&#8217;s Native Image with GraalVM</h2>
<div class="sectionbody">
<div class="paragraph">
<p>We are going to use <a href="https://www.graalvm.org/">GraalVM</a>, the polyglot embeddable virtual machine, to generate a Native image of our Micronaut application.</p>
</div>
<div class="paragraph">
<p>Native images compiled with GraalVM ahead-of-time improve the startup time and reduce the memory footprint of JVM-based applications.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Use of GraalVM&#8217;s <code>native-image</code> tool is only supported in Java or Kotlin projects. Groovy relies heavily on
reflection which is only partially supported by GraalVM.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="native-image-generation">7.1. Native Image generation</h3>
<div class="paragraph">
<p>The easiest way to install GraalVM is to use <a href="https://sdkman.io/">SDKMan.io</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash"># For Java 8
$ sdk install java 21.1.0.r8-grl

# For Java 11
$ sdk install java 21.1.0.r11-grl</code></pre>
</div>
</div>
<div class="paragraph">
<p>You need to install the <code>native-image</code> component which is not installed by default.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ gu install native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>To generate a native image using Maven run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">$ ./mvnw package -Dpackaging=native-image</code></pre>
</div>
</div>
<div class="paragraph">
<p>The native image will be created in <code>target/application</code> and can be run with <code>./target/application</code>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="next-steps">8. Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Visit <a href="https://docs.micronaut.io/latest/guide/index.html#httpClient">Micronaut HTTP Client documentation</a> to learn more.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="help-with-micronaut">9. Help with Micronaut</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://objectcomputing.com">Object Computing, Inc.</a> (OCI) sponsored the creation of this Guide. A variety of consulting and support services are available.</p>
</div>
<div class="paragraph">
<p><a href="https://objectcomputing.com/products/2gm-team">Meet the Team</a>.</p>
</div>

            </div>
        </div>
    </div>
</main>

<footer id="footer">
    <div class="container">

        <div class="row">
            <div class="col-sm-5 footer-left">

                <div id="text-14" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <img class="alignnone size-medium wp-image-3736" src="https://micronaut.io/wp-content/uploads/2021/03/Micronaut_byobjectcomputing_w.svg" alt=""/>
                        </p>
                    </div>
                </div>
            </div>
            <div class="col-sm-7 footer-right">

                <ul class="meta">

                    <li id="menu-item-2895" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2895">
                        <a href="https://micronaut.io/brand-guidelines/">Brand Guidelines</a>
                    </li>
                    <li id="menu-item-2894" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-2894">
                        <a href="https://micronaut.io/community-guidelines/">Community Guidelines</a>
                    </li>
                    <li id="menu-item-3377" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-privacy-policy menu-item-3377">
                        <a href="https://micronaut.io/privacy-policy/">Privacy Policy</a>
                    </li>

                </ul>

                <div id="nav_menu-2" class="widget widget_nav_menu">
                    <div class="menu-links-container">
                        <ul id="menu-links" class="menu">
                            <li id="menu-item-2885" class="show-on-blog menu-item menu-item-type-custom menu-item-object-custom menu-item-2885">
                                <a target="_blank" rel="noopener" href="https://micronaut.io/feed/rss/">
                                    <i class="fas fa-rss">
                                        <span class="sr-only">RSS</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2886" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2886">
                                <a target="_blank" rel="noopener" href="https://twitter.com/micronautfw">
                                    <i class="fab fa-twitter">
                                        <span class="sr-only">Twitter</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2887" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2887">
                                <a href="mailto:info@micronaut.io">
                                    <i class="fas fa-envelope">
                                        <span class="sr-only">Mail</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2888" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2888">
                                <a target="_blank" rel="noopener" href="https://gitter.im/micronautfw/">
                                    <i class="fab fa-gitter">
                                        <span class="sr-only">Gitter</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2889" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2889">
                                <a target="_blank" rel="noopener" href="https://github.com/micronaut-projects/">
                                    <i class="fab fa-github">
                                        <span class="sr-only">GitHub</span>
                                    </i>
                                </a>
                            </li>
                            <li id="menu-item-2890" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2890">
                                <a target="_blank" rel="noopener" href="https://www.youtube.com/playlist?list=PLI74De5M9T72YshO4Sc90wtGr286nM8Yu">
                                    <i class="fab fa-youtube">
                                        <span class="sr-only">YouTube</span>
                                    </i>
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="text-5" class="widget widget_text">
                    <div class="textwidget">
                        <p>
                            <small>© 2021 Object Computing, Inc. All rights reserved</small>
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </div>
</footer>
</body>
</html>

